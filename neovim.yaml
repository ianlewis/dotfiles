# Copyright 2024 Ian Lewis
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# This is a selene Lua standard libary definition file for neovim.
# It defines globals for neovim's environment.
# See the documentation for the format:
# https://kampfkarren.github.io/selene/usage/std.html

base: lua51
name: vim

structs:
  # VimDiagnosticSeverity is a definition of vim.diagnostic.severity.
  VimDiagnosticSeverity:
    ERROR:
      property: read-only
      type: number
    WARN:
      property: read-only
      type: number
    INFO:
      property: read-only
      type: number
    HINT:
      property: read-only
      type: number

  # VimLogLevels is a definition of vim.log.levels.
  VimLogLevels:
    TRACE:
      property: read-only
      type: number
    DEBUG:
      property: read-only
      type: number
    INFO:
      property: read-only
      type: number
    WARN:
      property: read-only
      type: number
    ERROR:
      property: read-only
      type: number
    FATAL:
      property: read-only
      type: number

  # Vim is a definition of the 'vim' global.
  # It is currently a non-exhaustive definition.
  # TODO(#112): Generate an exhaustive neovim stdlib definition.
  Vim:
    # Vim API.
    api:
      any: true

    # Vim buffer module.
    b:
      any: true

    # Vim buffer scoped options.
    bo:
      any: true

    # Vim command.
    cmd:
      any: true

    diagnostic.severity:
      struct: VimDiagnosticSeverity

    # Environment variables.
    env:
      any: true

    # Vim filetypes.
    filetype.add:
      args:
        - type: table

    # Vim functions.
    fn:
      any: true

    # Vim globals.
    g:
      any: true

    # Vim log levels.
    log.levels:
      struct: VimLogLevels

    # Vim keymap.
    keymap.set:
      args:
        - type: any # string or table
        - type: string
        - type: any # string or function
        - type: table
          required: false

    # Vim Lua bindings.
    loop:
      any: true

    # Vim lsp client.
    lsp.buf.declaration:
      args: []

    lsp.buf.definition:
      args: []

    lsp.buf.format:
      args: []

    lsp.buf.hover:
      args: []

    lsp.buf.implementation:
      args: []

    lsp.buf.signature_help:
      args: []

    lsp.config:
      args:
        - type: string
        - type: table
          required: false

    lsp.enable:
      args:
        - type: string
        - type: table
          required: false

    # Vim notifications.
    notify:
      args:
        - type: string
        - type: number
          required: false
        - type: table
          required: false

    # Vim options.
    opt:
      any: true

    # Vim print function.
    print:
      args:
        - type: any

    # Vim schedule function.
    schedule:
      args:
        - type: function

    schedule_wrap:
      args:
        - type: function

    tbl_deep_extend:
      args:
        - type: string
        - type: any
        - type: any

    uri_from_bufnr:
      args:
        - type: any
      returns:
        type: string

    # Vim treesitter module.
    treesitter.start:
      args: []

    # Vim ui module.
    ui:
      any: true

    # Vim Lua bindings.
    uv.fs_stat:
      args:
        - type: string

globals:
  vim:
    struct: Vim

  jit:
    any: true

  assert:
    args:
      - type: bool
      - type: string
        required: false

  describe:
    args:
      - type: string
      - type: function

  after_each:
    args:
      - type: function

  before_each:
    args:
      - type: function

  it:
    args:
      - type: string
      - type: function
